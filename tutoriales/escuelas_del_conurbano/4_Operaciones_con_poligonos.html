

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-88382509-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mas operaciones con poligonos &mdash; Geo-Python - AutoGIS  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Geo-Python - AutoGIS  documentation" href="../../index.html"/>
        <link rel="prev" title="Haciendo mapas con shapely y geopandas" href="3_Mapas.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Geo-Python - AutoGIS
          

          
            
            <img src="../../_static/logo_hy_geo_135.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2017
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Information General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../info/Instalacion.html">Instalar Python + packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../info/Introduccion.html">Introduccion</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial 1: Escuelas del Conurbano</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_Geopandas.html">Pandas para trabajar con tablas</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_Geolocalizacion.html">Geolocalizacion</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Mapas.html">Haciendo mapas con shapely y geopandas</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mas operaciones con poligonos</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Geo-Python - AutoGIS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>Mas operaciones con poligonos</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/Automating-GIS-processes/2017/blob/master/source/tutoriales/escuelas_del_conurbano/4_Operaciones_con_poligonos.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mas-operaciones-con-poligonos">
<h1>Mas operaciones con poligonos<a class="headerlink" href="#mas-operaciones-con-poligonos" title="Permalink to this headline">Â¶</a></h1>
<p>En los tutoriales pasados vimos algunas de las operaciones basicas que se pueden hacer con objetos shapely.Polygon y shapely.Point en un objeto geopandas.GeoDataFrame. Ahora, vamos a usar algunas de estas operaciones para calcular algo un poco mas complejo.</p>
<p>Recordemos que tenemos una tabla con las escuelas del area metropolitana de Buenos Aires y su ubicacion. Ademas, tenemos informacion de donde vive la gente de cada edad, al nivel de radios censales, que son distritos censales de pocos cientos de personas. En particular podemos contar cuantos chicos de 13 a 18 anios viven en cada radio censal.</p>
<p>Les propongo considerar el siguiente modelo. Asumamos que:</p>
<ul class="simple">
<li>Los chicos estan &#8216;vinculados&#8217; a la escuela secundaria publica mas cercana, midiendo en linea recta.</li>
<li>La poblacion hacia adentro de cada radio censal esta repartida de forma uniforme. Es decir que si un radio censal tiene 25 chicos, el 50% de su superficie tiene 12.5 chicos.</li>
</ul>
<p>es un modelo porque asumimos que se acerca a la realidad lo suficiente, aunque no esperamos tomar sus resultados exactos al pie de la letra. Tengamos en cuenta que los conteos del censo ni siquiera son exactos ya sea por problemas al momento de censar (como gente ausente, datos falsos o gente duplicada) o porque de todos modos el censo intenta medir la cantidad de gente y su ubicacion a la medianoche anterior a la encuesta, el 27 de octubre de 2010, y aunque hubieramos logrado medir con absoluta exactitud, a los &#8216;15 minutos&#8217; los numeros ya habran fluctuado.</p>
<p>Volviendo al modelo, usemoslo para contar cuantos chicos se encuentran en la zona de vecindad de cada escuela. Es decir, para cada escuela, cuantos chicos se estima que la tengan como la mas cercana, sumando la poblacion de chicos en los radios censales incluidos en la zona de vecindad, y fraccionando aquellos radios censales que tienen a mas de una escuela como la mas cercana.</p>
<p>Parece complicado, pero esta operacion se puede hacer sin muchas vueltas aprovechando las funcionalidades de los GeoDataFrames de geopandas y los poligonos de shapely. Veamos como...</p>
<p>Vamos a calcular ahora, para todas las intersecciones la fraccion de area del redio censal que cae en cada zona de vecindad (Voronoi).</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-1-bc466bdc7861&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="ne">NameError</span>: name &#39;df&#39; is not defined

<span class="gp">In [2]: </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-2-5e5ca6e14187&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="ne">NameError</span>: name &#39;df&#39; is not defined

<span class="c1">#iteramos las filas del dataset de intersecciones.</span>
<span class="gp">In [3]: </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="gp">   ...: </span>    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_y&#39;</span><span class="p">]))</span>
<span class="gp">   ...: </span>    <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span><span class="p">))</span>
<span class="gp">   ...: </span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-3-4b0ec71c0a23&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_y&#39;</span><span class="p">]))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">df</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 

<span class="ne">NameError</span>: name &#39;df&#39; is not defined

<span class="c1"># Construimos df_intersect multiplicando las fracciones de interseccion por la cantidad total de area, poblacion, etc.</span>
<span class="gp">In [4]: </span><span class="n">df_intersect</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;index_voronoi&#39;</span><span class="p">,</span><span class="s1">&#39;index_radio&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;varon&#39;</span><span class="p">,</span><span class="s1">&#39;mujer&#39;</span><span class="p">,</span><span class="s1">&#39;totalpobl&#39;</span><span class="p">,</span><span class="s1">&#39;hogares&#39;</span><span class="p">,</span><span class="s1">&#39;persona_13&#39;</span><span class="p">,</span><span class="s1">&#39;area_km2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">])))</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-4-fce08b9995b0&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df_intersect</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;index_voronoi&#39;</span><span class="p">,</span><span class="s1">&#39;index_radio&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;varon&#39;</span><span class="p">,</span><span class="s1">&#39;mujer&#39;</span><span class="p">,</span><span class="s1">&#39;totalpobl&#39;</span><span class="p">,</span><span class="s1">&#39;hogares&#39;</span><span class="p">,</span><span class="s1">&#39;persona_13&#39;</span><span class="p">,</span><span class="s1">&#39;area_km2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">])))</span>

<span class="ne">NameError</span>: name &#39;df&#39; is not defined

<span class="gp">In [5]: </span><span class="n">df_intersect</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;index_voronoi&#39;</span><span class="p">,</span><span class="s1">&#39;index_radio&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-5-4f609567f184&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df_intersect</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;index_voronoi&#39;</span><span class="p">,</span><span class="s1">&#39;index_radio&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;df_intersect&#39; is not defined

<span class="c1"># Agregar un prefijo para identificar estas columnas.</span>
<span class="gp">In [6]: </span><span class="n">df_intersect</span> <span class="o">=</span> <span class="n">df_intersect</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;intersect_&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-6-5609dfb1d426&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df_intersect</span> <span class="o">=</span> <span class="n">df_intersect</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;intersect_&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;df_intersect&#39; is not defined

<span class="gp">In [7]: </span><span class="n">df_intersect</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-7-7e52215069cb&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df_intersect</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="ne">NameError</span>: name &#39;df&#39; is not defined

<span class="gp">In [8]: </span><span class="n">df_intersect</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-8-83a35005d8d5&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df_intersect</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;intersect_portion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="ne">NameError</span>: name &#39;df&#39; is not defined
</pre></div>
</div>
<p>Ahora agregamos en cada vecindad de escuela la cantidad total de gente, y de paso agregamos el area para poder detectar si hay inconsistencias.</p>
<p>Por ultimo vamos a ver que tal se ve lo que acabamos de calcular. Grafiquemos la cantidad de chicos que le corresponden a cada escuela, donde en verde ubicamos los valores mas bajos y en rojo los mas altos.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="3_Mapas.html" class="btn btn-neutral" title="Haciendo mapas con shapely y geopandas" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Henrikki Tenkanen.
      Last updated on Jan 07, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>